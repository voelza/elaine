var ae=Object.defineProperty;var le=(f,c,v)=>c in f?ae(f,c,{enumerable:!0,configurable:!0,writable:!0,value:v}):f[c]=v;var r=(f,c,v)=>(le(f,typeof c!="symbol"?c+"":c,v),v);(function(f,c){typeof exports=="object"&&typeof module!="undefined"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(f=typeof globalThis!="undefined"?globalThis:f||self,c(f.ELAINE={}))})(this,function(f){"use strict";const c="@@",v="++",g="~",w="!++",Nt="##",Et=i=>new RegExp(c+"{"+i.replaceAll(/[.*+?^${}()|[\]\\]/g,"\\$&")+"}","g"),At=i=>new RegExp(c+i.replaceAll(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),y=new RegExp(c+"([!]?[a-zA-Z0-9\\(@@\\)_$.,\\s~\\|:']+)","g"),q=new RegExp(c+`\\{([!]?[a-zA-Z0-9\\(@@\\)_$.,\\s~\\|:'"]+)\\}`,"g"),Tt=new RegExp(c+"\\{(\\{.+\\})\\}","g"),Lt=new RegExp("(.+) in (.+)","g"),xt="|";function x(i,t){if(!t)return t;if(t instanceof Object){let e=t,n=i.indexOf(".");return n!==-1&&(i=i.substring(n+1),e=e.getValueForKeyPath(i)),e}else return t}function P(i){let t=i,e=t.indexOf(".");return e!==-1&&(t=t.substring(0,e)),t}function j(i){let t=i,e=t.indexOf(".");return e!==-1&&(t=t.substring(e+1)),t}class M{constructor(t,e){r(this,"bindingsMap");r(this,"parseTokens");this.bindingsMap=new Map;const n=[];for(const s of t.split(" ").filter(o=>o)){let o=s;if(o.startsWith("!")&&o!=="!="&&(o=o.substring(1),n.push("!")),n.push(o),o.startsWith(c)){const l=o.substring(c.length),a=e.find(u=>u.binding===l);a&&this.bindingsMap.set(l,a)}}this.parseTokens=n}getBindings(){return Array.from(this.bindingsMap.values())}eval(){var l;const t=[];for(const a of this.parseTokens)if(a.startsWith(c)){const u=a.substring(c.length),h=this.bindingsMap.get(u);h&&t.push(x(u,(l=h.state)==null?void 0:l.value))}else t.push(a);let e=[],n=0;for(;n<t.length;){const a=t[n];if(a==="!"){const u=t[n+1];e.push(!u),n=n+2}else if(a==="&&")e.push("&&"),n=n+1;else if(a==="||")e.push("||"),n=n+1;else{const u=t[n+1];if(this.isOperator(u)){const h=t[n+2];e.push(this.evalCondition(a,u,h)),n=n+3}else e.push(a),n=n+1}}let s=e[0],o=1;for(;o<e.length;){let a=e[o];if(a==="&&"){const u=e[o+1];u!=null&&(s=s&&u,o+=2)}else if(a==="||"){const u=e[o+1];u!=null&&(s=s||u,o+=2)}else o++}return s}isOperator(t){return t==="<"||t==="<="||t===">"||t===">="||t==="=="||t==="!="||t==="!=="||t==="==="}parseValue(t){return t==="null"?null:t==="undefined"?void 0:t}evalCondition(t,e,n){let s=this.parseValue(t),o=this.parseValue(n);return e==="<"?s<o:e==="<="?s<=o:e===">"?s>o:e===">="?s>=o:e==="=="?s instanceof Object&&o instanceof Object?JSON.stringify(s)==JSON.stringify(o):s==o:e==="==="?s instanceof Object&&o instanceof Object?JSON.stringify(s)===JSON.stringify(o):s===o:e==="!="?s instanceof Object&&o instanceof Object?JSON.stringify(s)!=JSON.stringify(o):s!=o:e==="!=="?s instanceof Object&&o instanceof Object?JSON.stringify(s)!==JSON.stringify(o):s!==o:!1}}class S{constructor(t){r(this,"_value");r(this,"subscribers",[]);this._value=t,this._value instanceof Array?this._value=new Proxy(this._value,{get:(e,n,s)=>{const o=Reflect.get(e,n,s);return n==="push"||n==="shift"||n==="unshift"||n==="pop"||n==="sort"?(...l)=>{e[n](...l),this.notify()}:n==="splice"?(l,a)=>{e[n](l,a),this.notify()}:o}}):this._value instanceof Object&&(this._value=new Proxy(this._value,{set:(e,n,s,o)=>{const l=Reflect.set(e,n,s,o);return this.notify(),l}}))}set value(t){this.set(t)}get value(){return this._value}set(t){this._value!==t&&(this._value=t,this.notify())}setPathValue(t,e){this._value.setValueForKeyPath(t,e),this.notify()}subscribe(t){this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.indexOf(t);e!==-1&&this.subscribers.splice(e,1)}notify(){for(const t of this.subscribers)t.update()}}class N{constructor(t){r(this,"value");r(this,"subscribers",[]);this.value=t}set(){}setPathValue(){}subscribe(t){this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.indexOf(t);e!==-1&&this.subscribers.splice(e,1)}notify(){}}class E{constructor(t,e){r(this,"value");r(this,"computer");r(this,"parents",[]);r(this,"subscribers",[]);this.computer=t,this.value=this.computer(),this.parents=e}init(){}update(){this.value=this.computer(),this.notify()}destroy(){for(const t of this.parents)t.unsubscribe(this)}notify(){for(const t of this.subscribers)t.update()}notifyParents(){for(const t of this.parents)t.notify()}set(){}setPathValue(){}subscribe(t){this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.indexOf(t);e!==-1&&this.subscribers.splice(e,1)}}function U(i,t){const e=t.parentElement;if(!e)return;const n=t.nextSibling;e.insertBefore(i,n)}function _(i,t){const e=t.parentElement;!e||e.insertBefore(i,t)}class H extends N{}class k{constructor(t){r(this,"bindings",[]);this.bindings=t}bind(t){var n;const e=this.bindings.reduce((s,o)=>(s.find(l=>l.stateName===o.stateName)===void 0&&s.push(o),s),[]);for(const s of e)(n=s.state)==null||n.subscribe(t)}}class St extends k{constructor(t,e){super(t);r(this,"conditionalBindings",[]);this.conditionalBindings=e}init(){this.update()}update(){for(const t of this.conditionalBindings)t.condition.eval()?t.value.init():t.value.destroy()}destroy(){for(const t of this.conditionalBindings)t.value.destroy()}}function Ct(i,t){const e=[];for(const n of i.split(";")){const s=n.split(":"),o=s[0].trim(),l=new M(o,t),a=s[1].trim();e.push({condition:l,value:a,stateBindings:[]})}return e}function Ot(i,t){const e=[];for(const n of t.split(";")){const s=n.split(":"),o=s[0].trim(),l=A(i,y,o),a=new M(o,l),u=s[1].trim();e.push({condition:a,stateBindings:l,value:u})}return e}class wt extends k{constructor(t,e,n,s){super(e);r(this,"element");r(this,"eventName");r(this,"listener");var o;this.bind(this),this.element=t,this.eventName=n,this.listener=l=>{var u;const a=[];for(const h of e)a.push(x(h.binding,(u=h.state)==null?void 0:u.value));return a.push(l),s(...a)},(o=this.element)==null||o.removeAttribute(v+this.eventName),this.immediateInitNeeded()&&this.init()}immediateInitNeeded(){return this.bindings.length===0||this.bindings.filter(t=>t.state instanceof H).length===this.bindings.length}init(){var t;(t=this.element)==null||t.addEventListener(this.eventName,this.listener)}update(){}destroy(){var t;(t=this.element)==null||t.removeEventListener(this.eventName,this.listener)}}function It(i,t){const e=[];let n=i;const s=n.indexOf("(");if(s!==-1){n=i.substring(0,s);const o=i.substring(s+1,i.length-1).split(",").map(l=>l.trim());for(const l of o){const a=l.replace(c,"");let u,h;if(l.startsWith(c))u=P(a),h=u.startsWith(g)?t.parent.getState(u.substring(g.length)):t.getState(u);else{u=a;let m=a;if(u.startsWith(xt)){const d=a.replace(/\|/,"{").replace(/\|/,"}").replaceAll(/(')([\s]+)(')/g,"$1,$3").replaceAll(/'/g,'"');m=JSON.parse(d)}h=new H(m)}e.push({binding:a,stateName:u,stateSubPath:j(a),state:h})}}return{name:n,params:e}}function I(i,t,e,n){const s=It(n,i),o=s.name,l=s.params,a=i.getMethod(o);if(a)return new wt(t,l,e,a)}function Bt(i,t,e,n){const s=Ot(i,n.substring(1,n.length-1)),o=[];for(const a of s){const u=I(i,t,e,a.value);u&&o.push({condition:a.condition,stateBindings:a.stateBindings,value:u})}const l=[];for(const a of o){const u=a.stateBindings;if(u)for(const m of u)l.push(m);const h=a.value;for(const m of h.bindings)l.find(d=>d.binding===m.binding)===void 0&&l.push(m)}i.addLink(new St(l,o))}function z(i,t,e,n=void 0){const s=e.name.substring(c.length),o=e.value;if(o.startsWith("{")&&o.endsWith("}"))Bt(i,t,s,o);else return o.startsWith(w)&&n!==void 0?I(n,t,s,o.substring(w.length)):I(i,t,s,o)}function X(i,t,e=0){const n=[];let s=i.exec(t);for(;s!==null;)n.push(s[e]),s=i.exec(t);return n}function Pt(i,t,e=1){return X(i,t,e).map(s=>{const o=s.trim(),l=P(o).trim(),a=j(o).trim();return{binding:o,stateName:l,stateSubPath:a}})}function Mt(i,t,e=[0]){const n=[];let s=i.exec(t);for(;s!==null;){const o=[];for(const l of e){const a=s[l];a&&o.push({group:l,value:a})}n.push({matches:o}),s=i.exec(t)}return n}function A(i,t,e,n=1){return Pt(t,e,n).filter(s=>{const o=s.stateName,l=i.getState(o);if(l)return s.state=l,!0;const a=o.substring(0,o.indexOf("(")).trim();if(!i.getMethod(a))return!1;const h=I(i,void 0,"",s.binding);if(!h)return!1;const m=[];for(const b of h.bindings)b.state&&m.push(b.state);const d=new E(()=>h.listener(void 0),m);for(const b of m)b.subscribe(d);return i.addLink(d),s.stateName=a,s.state=d,!0})}function _t(i,t){if(t.startsWith(c)){const s=t.substring(c.length),o=P(s),l=i.getState(o);if(l)return{computer:()=>x(s,l.value),states:[l]}}const e=t.substring(0,t.indexOf("(")).trim();if(i.getMethod(e)){const s=I(i,void 0,"",t),o=[];for(const l of s.bindings)l.state&&o.push(l.state);return{computer:()=>s.listener(void 0),states:o}}return{computer:()=>t,states:[]}}function Z(i,t){const e=_t(i,t),n=new E(e.computer,e.states);for(const s of e.states)s.subscribe(n);return i.addLink(n),n}class Q extends k{constructor(t,e,n=void 0){super(t);r(this,"template");r(this,"isConditional");r(this,"conditionalBindings",[]);r(this,"valueObjectsToStrConverter");this.bind(this),this.isConditional=e.startsWith("{")&&e.endsWith("}"),this.template=this.isConditional?e.substring(1,e.length-1):e,this.valueObjectsToStrConverter=n,this.isConditional&&(this.conditionalBindings=Ct(this.template,t))}init(){this.update()}destroy(){var t;for(const e of this.bindings)(t=e.state)==null||t.unsubscribe(this)}update(){if(this.isConditional){let t="";for(const e of this.conditionalBindings)e.condition.eval()&&(t+=this.applyBindingsToTemplate(e.value)+" ");this.updateBinding(t)}else this.updateBinding(this.applyBindingsToTemplate(this.template))}applyBindingsToTemplate(t){let e=t;for(const n of this.bindings)e=this.updateTemplate(e,n);return e.replaceAll(new RegExp(Nt,"g"),"")}updateTemplate(t,e){var a;let n=t;if(!e.binding)return n;const s=this.bindingRegex(e.binding),o=(a=e.state)==null?void 0:a.value,l=x(e.binding,o);return n=n.replaceAll(s,this.valueAsString(l)),n}valueAsString(t){return t instanceof Object?this.valueObjectsToStrConverter?this.valueObjectsToStrConverter(t):JSON.stringify(t):t}bindingRegex(t){return At(t)}}class kt extends Q{constructor(t,e,n){super(e,n.trim());r(this,"text");this.text=t}bindingRegex(t){return Et(t)}updateBinding(t){this.text.textContent=t}}function W(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var t=Math.random()*16|0,e=i=="x"?t:t&3|8;return e.toString(16)})}class Vt{constructor(t,e,n){r(this,"element");r(this,"binding");r(this,"isPathValue");r(this,"inputListener");r(this,"targetAttribute");r(this,"eventListener");this.element=e,this.binding=n,this.isPathValue=n.binding!==n.stateName,this.inputListener=this.getInputListener(n),this.element.removeAttribute(c+"model"),this.targetAttribute=e.getAttribute("type")==="checkbox"?"checked":"value",this.eventListener=this.createInputListener(t)}getInputListener(t){return this.isPathValue?e=>{var s;const n=e.target;n&&((s=t.state)==null||s.setPathValue(t.stateSubPath,n[this.targetAttribute]))}:e=>{const n=e.target;n&&t.state&&(t.state.value=n[this.targetAttribute])}}createInputListener(t){const e=this.binding.binding+"-"+W();return t.addMethod(e,this.inputListener),z(t,this.element,{name:"++input",value:e})}init(){var t;this.update(),(t=this.eventListener)==null||t.init()}update(){var t,e,n;this.isPathValue?this.element[this.targetAttribute]=(e=(t=this.binding.state)==null?void 0:t.value)==null?void 0:e.getValueForKeyPath(this.binding.stateSubPath):this.element[this.targetAttribute]=(n=this.binding.state)==null?void 0:n.value}destroy(){var t,e;(t=this.eventListener)==null||t.destroy(),(e=this.binding.state)==null||e.unsubscribe(this)}}class Ft extends S{constructor(t,e){super(t);r(this,"list");this.list=e}notify(){super.notify(),this.list instanceof E?this.list.notifyParents():this.list.notify()}}class Rt{constructor(t,e,n,s){r(this,"id",W());r(this,"instance");r(this,"loopValueName");r(this,"binding");r(this,"forComment");r(this,"loopTemplate");r(this,"initDone");r(this,"loopInstances");this.initDone=!1,this.instance=t,this.loopValueName=n,this.binding=s,this.forComment=document.createComment("for-"+this.id),U(this.forComment,e),e.remove(),this.loopTemplate=e.cloneNode(!0),e.removeAttribute(c+"for"),this.loopTemplate.removeAttribute(c+"for"),this.loopInstances=[]}init(){var t;this.initDone||(this.initDone=!0,this.insertLoopChildren(x(this.binding.binding,(t=this.binding.state)==null?void 0:t.value)))}update(){var t;this.resetLoop(),this.insertLoopChildren(x(this.binding.binding,(t=this.binding.state)==null?void 0:t.value))}destroy(){var t;for(const e of this.loopInstances)e.destroy();(t=this.binding.state)==null||t.unsubscribe(this)}resetLoop(){for(const t of this.loopInstances)t.unmount(),t.destroy();this.loopInstances=[]}insertLoopChildren(t){if(!!t)for(let e=t.length-1;e>=0;e--){const n=t[e],s=new R(B.LOOP,this.loopTemplate,this.loopTemplate,this.instance);s.merge(this.instance),s.addState(this.loopValueName,new Ft(n,this.binding.state)),s.addState("_index",new N(e)),s.appendMount(this.forComment),this.loopInstances.push(s)}}}const Dt=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","truespeed"];class jt extends Q{constructor(t,e,n,s){super(e,s,o=>{if(o instanceof Array)return o.join(" ");let l="";for(const a in o)l+=a+":"+o[a]+";";return l});r(this,"element");r(this,"attribute");r(this,"staticValue");r(this,"isBooleanAttribute");this.element=t,this.attribute=n,this.isBooleanAttribute=Dt.includes(this.attribute),this.element.removeAttribute(c+this.attribute),this.staticValue=this.element.getAttribute(this.attribute)}updateBinding(t){this.element.removeAttribute(this.attribute);let e="";this.staticValue!==null&&(e+=this.staticValue,e+=" "),e+=t,(!this.isBooleanAttribute||e==="true")&&this.element.setAttribute(this.attribute,e)}}class Y extends k{constructor(t,e,n,s,o=void 0){super(e);r(this,"id",W());r(this,"ifComment");r(this,"element");r(this,"instance");r(this,"condition");r(this,"isElementRendered");this.bind(this),this.condition=n,this.ifComment=document.createComment("if-"+this.id),_(this.ifComment,t),this.element=t,this.element.removeAttribute(c+"if"),this.instance=o!=null?o:new R(B.IF,this.element,this.element).merge(s),this.element.remove()}init(){this.eval()}update(){this.eval()}destroy(){var t;for(const e of this.bindings)(t=e.state)==null||t.unsubscribe(this);this.instance.destroy()}eval(){const t=this.condition.eval();t?(!this.isElementRendered||this.isElementRendered===void 0)&&(this.isElementRendered=t,this.instance.appendMount(this.ifComment)):(this.isElementRendered||this.isElementRendered===void 0)&&(this.isElementRendered=t,this.instance.unmount())}}function K(i,t,e=void 0){if(t.tagName==="SCRIPT"||t instanceof Comment)return;if(t.tagName==="TEMPLATE-STATE"){Ht(i,t);return}if(t.hasAttribute&&t.hasAttribute(ot)){zt(i,t,e);return}let n=!0;!(t instanceof Text)&&t.hasAttributes()&&(n=Kt(i,t,e)),t instanceof Text&&Wt(i,t),n&&t.hasChildNodes()&&!i.isComponentElement(t.tagName)&&Ut(i,t.childNodes,e)}function Ut(i,t,e=void 0){for(let n=0;n<t.length;n++){const s=t[n];K(i,s,e)}}function Wt(i,t){const e=t.textContent;if(!e)return;let n=[];const s=X(Tt,e,1);let o=e;s.length===1?(o=s[0],n=A(i,y,o)):n=A(i,q,e),n.length!==0&&i.addLink(new kt(t,n,o))}function Kt(i,t,e=void 0){let n=!0;for(const s of Array.from(t.attributes))if(s.name===c+"for")$t(i,t,s),n=!1;else if(s.name===c+"model")Gt(i,t,s);else if(s.name===c+"if")Jt(i,t,s),n=!1;else if(s.name.startsWith(c))qt(i,t,s);else if(s.name.startsWith(v))if(i.getComponent(t.tagName)!==void 0)s.value.startsWith(w)&&(s.value=s.value.substring(w.length)),s.value=w+s.value;else{const l=z(i,t,s,e);l&&i.addLink(l)}return n}function $t(i,t,e){var u,h,m;const n=Mt(Lt,e.value,[1,2]);if(n.length!==1)return;const s=n[0].matches,o=(u=s.find(d=>d.group===1))==null?void 0:u.value.trim(),l=(h=s.find(d=>d.group===2))==null?void 0:h.value.trim();if(!o||!l)return;const a=A(i,y,l);if(a.length===1){const d=a[0],b=new Rt(i,t,o,d);(m=d.state)==null||m.subscribe(b),i.addLink(b)}}function Gt(i,t,e){const n=e.value.replaceAll(c,"").trim(),s=n.startsWith(g),o=s?n.substring(g.length):n,l=s?i.parent:i,a=P(o),u=l.getState(a);if(!u)return;const h=j(o),m={binding:o,stateName:a,stateSubPath:h,state:u},d=new Vt(l,t,m);u.subscribe(d),l.addLink(d)}function Jt(i,t,e){if(i.getComponent(t.tagName))return;const n=e.value,s=A(i,y,n);s.length!==0&&i.addLink(new Y(t,s,new M(n,s),i))}function qt(i,t,e){const n=e.name.substring(c.length),s=e.value,o=A(i,y,s);o.length!==0&&i.addLink(new jt(t,o,n,s))}function Ht(i,t){for(const e of Array.from(t.attributes))i.addState(e.name,Z(i,e.value));t.remove()}function zt(i,t,e){const n=t.getAttribute(rt),s=Z(i,n);let o=null;for(const a of Array.from(t.children)){const u=a.tagName.toLowerCase();if(u==(s==null?void 0:s.value)){o=a;break}else o===null&&u==="default"&&(o=a);a.remove()}if(!o)throw"Slot-Resolve-Error: Slots with variants must provide a default slot!";const l=Array.from(o.childNodes);for(const a of l)_(a,t),K(i,a,e);t.remove()}class Xt{constructor(){r(this,"listeners",new Map)}dispatchEvent(t,e){var n;for(const s of(n=this.listeners.get(t))!=null?n:[])s(e)}addListener({eventName:t,listener:e}){let n=this.listeners.get(t);n===void 0&&(n=[]),n.push(e),this.listeners.set(t,n)}removeListener({eventName:t,listener:e}){const n=this.listeners.get(t);if(n===void 0)return;n.indexOf(e)!==-1&&n.splice(n.indexOf(e),1)}}var V=new Xt;class Zt{constructor(t){r(this,"notify");this.notify=t}add(t){for(const e of Object.keys(t)){let n=t[e];!(n instanceof S)&&!(n instanceof E)&&!(n instanceof N)&&(n=new N(n)),this["_"+e]=n,Object.defineProperty(this,e,{get:()=>n.value,set:s=>{n.value=s,this.notify()}})}}watch(t,e){const n=this["_"+t];n&&yt.watch(()=>{e(n.value)},n)}}function Qt(i){return()=>{for(const t of i)t.update()}}class Yt{constructor(){r(this,"_value");r(this,"subscribers");r(this,"triggerNotify");this.subscribers=[],this.triggerNotify=Qt(this.subscribers),this._value=new Zt(this.triggerNotify)}set value(t){throw"Not allowed to change Store value"}get value(){return this._value}set(){}setPathValue(){}subscribe(t){this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.indexOf(t);e!==-1&&this.subscribers.splice(e,1)}notify(){this.triggerNotify()}}var $=new Yt;class tt{constructor(t,...e){r(this,"watcher");r(this,"states");this.watcher=t,this.states=e}init(){}update(){this.watcher()}destroy(){for(const t of this.states)t.unsubscribe(this)}}const et=[{name:"short",format:{dateStyle:"short",timeStyle:"short"}},{name:"long",format:{dateStyle:"long",timeStyle:"long"}},{name:"medium",format:{dateStyle:"medium",timeStyle:"medium"}},{name:"full",format:{dateStyle:"full",timeStyle:"full"}}],te=[{name:"int",format:{minFractions:0,maxFractions:0}},{name:"twoDigits",format:{minFractions:2,maxFractions:2}}];let T=new S({dateFormats:et});function ee(i){i.dateFormats=[...i.dateFormats||[],...et],i.numberFormats=[...i.numberFormats||[],...te],T.value=i}let G=T.value.locale;const F=new Map,nt=new Map,it=()=>{G=T.value.locale,F.clear();for(const i of T.value.dateFormats||[])F.set(i.name,i.format);F.clear();for(const i of T.value.numberFormats||[])nt.set(i.name,i.format)};it();const ne=new tt(it,T);T.subscribe(ne);function st(i,t=void 0){const e=t?F.get(t):void 0;return new Intl.DateTimeFormat(G,{dateStyle:e==null?void 0:e.dateStyle,timeStyle:e==null?void 0:e.timeStyle}).format(i)}function ie(i,t=void 0){return st(new Date(i),t)}function se(i,t=void 0){const e=t?nt.get(t):void 0;return new Intl.NumberFormat(G,{maximumFractionDigits:e==null?void 0:e.maxFractions,minimumFractionDigits:e==null?void 0:e.minFractions}).format(i)}var B=(i=>(i[i.SETUP=0]="SETUP",i[i.COMPONENT=1]="COMPONENT",i[i.IF=2]="IF",i[i.LOOP=3]="LOOP",i))(B||{});const ot="elaine-slot",rt="elaine-slot-resolver",at="elaine-parent-component",J=[];class R{constructor(t,e,n,s=void 0,o=[],l=[],a=void 0,u=void 0,h=void 0,m=void 0,d=void 0,b=void 0,O=void 0){r(this,"origin");r(this,"element");r(this,"parent");r(this,"template");r(this,"states",new Map);r(this,"methods",new Map);r(this,"components",new Map);r(this,"links",[]);r(this,"childInstances",[]);r(this,"condition");r(this,"conditionLink");r(this,"props",[]);r(this,"slots",[]);r(this,"setup");r(this,"onMounted");r(this,"beforeUnmounted");r(this,"onUnmounted");r(this,"beforeDestroyed");r(this,"onDestroyed");r(this,"internalState");r(this,"wasCreated");r(this,"dispatchEvent");r(this,"globalEventListeners",[]);r(this,"dispatchGlobalEvent");r(this,"addGlobalEventListener");r(this,"styleElement");this.origin=t,this.element=e,this.template=n.cloneNode(!0),this.parent=s,this.props=o,this.slots=l,this.setup=a,this.onMounted=u,this.beforeUnmounted=h,this.onUnmounted=m,this.beforeDestroyed=d,this.onDestroyed=b;for(const p of O!=null?O:[])this.components.set(p.name,p);if(this.dispatchEvent=(p,L)=>{const D=new CustomEvent(p,{detail:L});this.template.dispatchEvent(D)},this.dispatchGlobalEvent=(p,L)=>{V.dispatchEvent(p,L)},this.addGlobalEventListener=(p,L)=>{const D={eventName:p,listener:L};V.addListener(D),this.globalEventListeners.push(D)},this.internalState={element:this.template,data:{},methods:{},refs:{},$store:$.value,dispatchEvent:this.dispatchEvent,dispatchGlobalEvent:this.dispatchGlobalEvent,addGlobalEventListener:this.addGlobalEventListener},this.condition=this.extractCondition(e),this.condition&&(this.conditionLink=new Y(e,this.condition.getBindings(),this.condition,void 0,this),this.conditionLink.init()),this.wasCreated=!1,this.methods.set("$date",st),this.methods.set("$strDate",ie),this.methods.set("$number",se),this.states.set("$store",$),this.components.size>0)for(const p of this.components.values()){J.push(p.name);for(const L of p.slots)J.push(L.toUpperCase())}}isComponentElement(t){return J.includes(t)}setupIfNeeded(){if(!this.wasCreated){this.resolveProps(this.element,this.parent),this.resolveSetup(),this.resolveSlots(this.element);for(const t of Array.from(this.element.attributes)){if(t.name.startsWith(ut))continue;const e=t.cloneNode(!0);this.template.attributes.setNamedItem(e)}K(this,this.template,this.parent);for(const t of this.links)t.init();if(this.initComponents([this.template]),this.origin===0){const t=this.gatherAllComponents().map(e=>e.css).filter(e=>e!==void 0).reduce((e,n)=>e+" "+n,"");t&&(this.styleElement=document.createElement("style"),this.styleElement.textContent=t)}this.wasCreated=!0}}gatherAllComponents(){return[...this.components.values(),...this.childInstances.map(t=>t.components.values()).flatMap(t=>Array.from(t))]}addLink(t){this.links.push(t)}getState(t){var o;if(t.startsWith(g))return(o=this.parent)==null?void 0:o.getState(t.substring(g.length));const e=this.states.get(t);if(!t.startsWith("!"))return e;const n=this.states.get(t.substring(1));if(!n)return;const s=new E(()=>!n.value,[n]);return n.subscribe(s),this.states.set(t,s),this.addLink(s),s}addState(t,e){this.states.set(t,e)}merge(t){if(!t)return this;for(const e of t.states.entries())this.states.set(e[0],e[1]);for(const e of t.methods.entries())this.addMethod(e[0],e[1]);for(const e of t.components.entries())this.registerComponent(e[0],e[1]);return this.parent=t.parent,this}getMethod(t){var e;return t.startsWith(g)?(e=this.parent)==null?void 0:e.getMethod(t.substring(g.length)):this.methods.get(t)}addMethod(t,e){this.methods.set(t,e)}registerComponent(t,e){this.components.set(t,e)}getComponent(t){return this.components.get(t)}mount(){this.condition&&!this.condition.eval()||(U(this.template,this.element),this.element.remove(),this.setupIfNeeded(),this.styleElement&&document.body.prepend(this.styleElement),this.onMounted&&this.onMounted(this.internalState))}appendMount(t){this.condition&&!this.condition.eval()||(U(this.template,t),this.setupIfNeeded(),this.onMounted&&this.onMounted(this.internalState))}extractCondition(t){var s;const e=t.getAttribute(c+"if");if(!e)return;const n=A((s=this.parent)!=null?s:this,y,e);return new M(e,n)}resolveSlots(t){var e;for(const n of this.slots){const s=this.template.querySelector(n);if(!s)continue;const o=s.getAttribute("variant"),l=t.querySelector(n);if(l)if(lt(l,(e=this.parent)==null?void 0:e.components),o)l.setAttribute(ot,""),l.setAttribute(rt,o),_(l,s);else for(const a of Array.from(l.childNodes))_(a,s);s.remove()}}resolveProps(t,e){for(const n of this.props){const s=n.name,o=t.getAttribute(s);if(o){const l=o.substring(c.length),a=e==null?void 0:e.getState(l);if(a&&a instanceof S||a instanceof N||a instanceof E)this.states.set(s,a),this.internalState.data[s]=a;else if(o){const u=new N(this.parseIntoType(n.type,o));this.states.set(s,u),this.internalState.data[s]=a}t.removeAttribute(s)}else{if(n.required||n.required===void 0)throw`Prop-Read-Error: "${s}" is a required prop and was not provided.`;{const l=new N(n.default);this.states.set(s,l),this.internalState.data[s]=n.default}}}}parseIntoType(t,e){return e==="null"?null:e==="undefined"?void 0:t===Number?e.includes(".")?Number.parseFloat(e):Number.parseInt(e):t===Boolean?e==="true":t===Object||t===Array?JSON.parse(e):e}resolveSetup(){var e;if(!this.setup)return;const t=this.setup(this.internalState);if(t){for(const n of t.components||[])this.registerComponent(n.name,n);for(const n in(e=t.state)!=null?e:{}){const s=t.state[n];s instanceof Function?(this.methods.set(n,s),this.internalState.methods[n]=s):s instanceof S||s instanceof E||s instanceof N?(this.states.set(n,s),this.internalState.data[n]=s):(this.states.set(n,new N(s)),this.internalState.data[n]=s)}}}initComponents(t){var e;for(let n=0;n<t.length;n++){const s=t[n],l=s.getAttribute&&s.getAttribute(at)!==null?(e=this.parent)==null?void 0:e.getComponent(s.tagName):this.getComponent(s.tagName);if(l!==void 0){const a=l.toInstance(s,this);this.childInstances.push(a);const u=s.getAttribute("ref");u&&(this.internalState.refs[u]=a.internalState),a.condition===void 0&&a.mount();continue}s.hasChildNodes()&&this.initComponents(s.childNodes)}}unmount(){var t;this.beforeUnmounted&&this.beforeUnmounted(this.internalState),this.template.remove(),(t=this.styleElement)==null||t.remove();for(const e of this.childInstances)e.unmount();this.onUnmounted&&this.onUnmounted(this.internalState)}destroy(){var t;this.beforeDestroyed&&this.beforeDestroyed(this.internalState);for(const e of this.childInstances)e.destroy();this.childInstances=[];for(const e of this.links)e.destroy();(t=this.conditionLink)==null||t.destroy();for(const e of this.globalEventListeners)V.removeListener(e);this.globalEventListeners=[],this.onDestroyed&&this.onDestroyed(this.internalState)}}function lt(i,t){if(t!=null&&t.get(i.tagName)&&i.setAttribute(at,""),i instanceof Text&&i.textContent&&i.textContent.length!==0){const e=i.textContent.replaceAll(q,(n,s)=>c+"{"+C(s)+"}").replaceAll(y,(n,s)=>c+C(s));i.textContent=e}else if(i.hasAttributes())for(const e of Array.from(i.attributes))e.name===c+"model"?e.value=C(e.value.replace(c,"")):e.name.startsWith(v)?e.value=C(e.value).replaceAll(y,(n,s)=>c+C(s)):e.value=e.value.replaceAll(y,(n,s)=>c+C(s));i.hasChildNodes()&&oe(i.childNodes,t)}function oe(i,t){for(let e=0;e<i.length;e++){const n=i[e];lt(n,t)}}function C(i){return i.startsWith(g)?i.substring(g.length):g+i}const ut="data-elaine-c-";class re{constructor(t,e,n=[],s=[],o=void 0,l=void 0,a=void 0,u=void 0,h=void 0,m=void 0,d=void 0){r(this,"name");r(this,"template");r(this,"props",[]);r(this,"slots",[]);r(this,"setup");r(this,"onMounted");r(this,"beforeUnmounted");r(this,"onUnmounted");r(this,"beforeDestroyed");r(this,"onDestroyed");r(this,"css");if(this.name=t,this.template=e.cloneNode(!0),this.props=n,this.slots=s,this.setup=o,this.onMounted=l,this.beforeUnmounted=a,this.onUnmounted=u,this.beforeDestroyed=h,this.onDestroyed=m,d){const b=ut+t.toLowerCase();this.css=d.replaceAll(/.*\{/g,O=>`${O.substring(0,O.length-1).trim()}[${b}] {`).replace(/  |\r\n|\n|\r/gm,""),this.addAttributeToAllElements(this.template,b)}}addAttributeToAllElements(t,e){if(t.setAttribute(e,""),t.children.length>0)for(const n of Array.from(t.children))this.addAttributeToAllElements(n,e)}toInstance(t,e){return new R(B.COMPONENT,t,this.template,e,this.props,this.slots,this.setup,this.onMounted,this.beforeUnmounted,this.onUnmounted,this.beforeDestroyed,this.onDestroyed)}}Object.defineProperty(Object.prototype,"setValueForKey",{value:function(i,t){this[t]=i}}),Object.defineProperty(Object.prototype,"setValueForKeyPath",{value:function(i,t){if(i==null)return;if(i.indexOf(".")===-1){this.setValueForKey(t,i);return}const e=i.split("."),n=e.shift(),s=e.join(".");n&&this[n].setValueForKeyPath(s,t)}}),Object.defineProperty(Object.prototype,"getValueForKey",{value:function(i){return this[i]}}),Object.defineProperty(Object.prototype,"getValueForKeyPath",{value:function(i){if(i!=null){if(i.indexOf(".")===-1)return this.getValueForKey(i);var t=i.split("."),e=t.shift(),n=t.join(".");if(e)return this[e].getValueForKeyPath(n)}}});function ct(i,t=void 0){const e=new R(B.SETUP,i,i,void 0,[],[],()=>t,t==null?void 0:t.onMounted,t==null?void 0:t.beforeUnmounted,t==null?void 0:t.onUnmounted,t==null?void 0:t.beforeDestroyed,t==null?void 0:t.onDestroyed,t==null?void 0:t.components);return e.mount(),console.log(e),e.internalState}function ht(i){return new S(i)}function dt(i,...t){const e=new tt(i,...t);for(const n of t)n.subscribe(e)}function ft(i,...t){const e=new E(i,t);for(const n of t)n==null||n.subscribe(e);return e}function mt(i){const t=document.createElement("template");return i=i.trim(),t.innerHTML=i,t.content.firstChild}function bt(i){const t=i.name.toUpperCase(),e=typeof i.template=="string"?mt(i.template):i.template;return new re(t,e,i.props,i.slots,i.setup,i.onMounted,i.beforeUnmounted,i.onUnmounted,i.beforeDestroyed,i.onDestroyed,i.css)}function pt(){return V}function gt(){return $.value}function vt(i){ee(i)}var yt={setup:ct,state:ht,watch:dt,computed:ft,component:bt,eventHub:pt,store:gt,withOptions:vt};f.component=bt,f.computed=ft,f.default=yt,f.eventHub=pt,f.setup=ct,f.state=ht,f.store=gt,f.templateToElement=mt,f.watch=dt,f.withOptions=vt,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
